<div class="flex flex-col lg:flex-row h-screen text-gray-800 dark:text-gray-100 transition-colors duration-300 mt-4">
    <div class="w-full lg:w-60 bg-transparent md:bg-indigo-50 md:dark:bg-gray-800 p-4 flex-shrink-0 lg:h-screen pt-16 md:pt-24 pb-0 hidden xl:block">
        <div class="flex flex-col gap-4 lg:flex-col lg:h-full lg:justify-between">

            <div class="flex flex-col gap-4 flex-1 md:flex-none bg-white dark:bg-gray-900 rounded-md shadow-lg mb-0 md:mb-6 p-4 transition-all duration-300 hover:-translate-y-1 hover:shadow-xl md:border-none px-6 md:px-4">
                <a routerLink="/game" [queryParams]="{ openModal: 'createRoom' }"
                   class="flex items-center text-gray-600 dark:text-gray-300 hover:text-indigo-800 dark:hover:text-indigo-400 py-4 transition-all duration-300 hover:translate-x-1">
                    <span class="material-icons-outlined mr-2">dashboard</span>
                    {{ 'home.menu.game' | translate }}
                    <span class="material-icons-outlined ml-auto">keyboard_arrow_right</span>
                </a>
                <a (click)="openRoomModal()"
                   class="flex items-center text-gray-600 dark:text-gray-300 hover:text-indigo-800 dark:hover:text-indigo-400 py-4 transition-all duration-300 hover:translate-x-1 cursor-pointer">
                    <span class="material-icons-outlined mr-2">meeting_room</span>
                    {{ 'home.menu.rooms' | translate }}
                    <span class="material-icons-outlined ml-auto">keyboard_arrow_right</span>
                </a>

                <a (click)="openInviteModal()"
                   class="flex items-center text-gray-600 dark:text-gray-300 hover:text-indigo-800 dark:hover:text-indigo-400 py-4 transition-all duration-300 hover:translate-x-1 cursor-pointer">
                    <span class="material-icons-outlined mr-2">mail</span>
                    {{ 'home.menu.invitations' | translate }}
                    <span class="material-icons-outlined ml-auto">keyboard_arrow_right</span>
                </a>


                <!--                <a href="#"-->
                <!--                   class="flex items-center text-gray-600 dark:text-gray-300 hover:text-indigo-800 dark:hover:text-indigo-400 py-4 transition-all duration-300 hover:translate-x-1">-->
                <!--                    <span class="material-icons-outlined mr-2">tune</span>-->
                <!--                    {{ 'home.menu.stats' | translate }}-->
                <!--                    <span class="material-icons-outlined ml-auto">keyboard_arrow_right</span>-->
                <!--                </a>-->
            </div>
            <div class="flex flex-col gap-4 flex-1 md:flex-none bg-white dark:bg-gray-900 rounded-md shadow-lg mb-0 md:mb-6 p-4 transition-all duration-300 hover:-translate-y-1 hover:shadow-xl md:border-none px-6 md:px-4">
                <a routerLink="/profile"
                   class="flex items-center text-gray-600 dark:text-gray-300 hover:text-indigo-800 dark:hover:text-indigo-400 py-4 transition-all duration-300 hover:translate-x-1">
                    <span class="material-icons-outlined mr-2">face</span>
                    {{ 'home.menu.profile' | translate }}
                    <span class="material-icons-outlined ml-auto">keyboard_arrow_right</span>
                </a>
                <a (click)="logout()"
                   class="flex items-center text-gray-600 dark:text-gray-300 hover:text-indigo-800 dark:hover:text-indigo-400 py-4 transition-all duration-300 hover:translate-x-1 cursor-pointer">
                    <span class="material-icons-outlined mr-2">power_settings_new</span>
                    {{ 'home.menu.logout' | translate }}
                    <span class="material-icons-outlined ml-auto">keyboard_arrow_right</span>
                </a>

                <div class="border-t border-gray-200 dark:border-gray-700 pt-6">
                    <div class="flex items-center justify-between gap-4">
                        <button (click)="toggleTheme()"
                                class="text-gray-600 dark:text-gray-300 hover:text-indigo-800 dark:hover:text-indigo-400 transition-transform hover:scale-110">
    <span class="material-icons-outlined text-[24px]">
      {{ themeService.isDark() ? 'light_mode' : 'dark_mode' }}
    </span>
                        </button>

                        <div class="relative">
                            <select
                                    class="appearance-none bg-white dark:bg-gray-800 text-sm rounded-lg px-3 py-2 border border-gray-300 dark:border-gray-600 focus:outline-none transition w-32 pl-10 pr-6 text-center cursor-pointer"
                                    [value]="translate.currentLang"
                                    (change)="changeLanguage($event)">
                                <option value="hu">ðŸ‡­ðŸ‡º {{ 'language.hu' | translate }}</option>
                                <option value="en">ðŸ‡¬ðŸ‡§ {{ 'language.en' | translate }}</option>
                            </select>
                            <span class="absolute left-2 top-2.5 text-gray-500 dark:text-gray-400 pointer-events-none material-icons-outlined text-sm">
                                  language
                                </span>
                            <span class="absolute right-2 top-2.5 text-gray-500 dark:text-gray-400 pointer-events-none material-icons-outlined text-sm">
                              expand_more
                            </span>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div class="flex-1 p-4 max-w-7xl lg:mx-auto px-4 pt-16 lg:pt-24">
        <div class="flex flex-col lg:flex-row gap-4 mb-4">
            <div class="flex-1 bg-indigo-100 dark:bg-indigo-900 border border-indigo-200 dark:border-indigo-700 rounded-lg p-4 animate-fade-in">
                <h2 class="pl-4 xl:pl-0 text-4xl md:text-5xl text-blue-900 dark:text-indigo-200">
                    {{ 'home.hero.welcome' | translate }}
                    <ng-container *ngIf="nickname; else skeleton">
                        <span class="text-2xl text-indigo-600 dark:text-indigo-300">{{ nickname }}</span>!
                    </ng-container>
                    <ng-template #skeleton>
                        <span class="ml-2 inline-block h-6 w-32 bg-indigo-300 dark:bg-indigo-700 rounded animate-pulse"></span>
                    </ng-template>
                </h2>


                <p *ngIf="quote" class="pl-2  text-lg italic text-gray-800 dark:text-gray-300">
                    {{ quote }}
                </p>

                <button (click)="getMotivationalQuote()"
                        [disabled]="quoteRequestsLeft <= 0"
                        class="mt-4 inline-flex items-center gap-2 bg-indigo-600 hover:bg-indigo-700 text-white px-4 py-2 rounded transition disabled:opacity-50 disabled:cursor-not-allowed">
                    <span class="material-icons-outlined">autorenew</span>
                    {{ 'home.hero.new_quote' | translate }} ({{ quoteRequestsLeft }}/3)
                </button>



            </div>

            <div class=" justify-center items-center bg-white dark:bg-gray-900 border border-gray-200 dark:border-gray-700 rounded-xl p-4">
                <h3 class="text-xl font-bold text-gray-800 dark:text-gray-100 pt-0 lg:pt-2">
                    {{ 'home.latestUsersTitle' | translate }}
                </h3>

                <div class="overflow-hidden">
                    <ul class="flex gap-4 overflow-hidden min-w-[20rem]">
                        <ng-container *ngIf="!isRandomUsersLoading; else skeletonLoading">
                            <ng-container *ngFor="let user of randomUsersNotFriends">
                                <li class="flex flex-col items-center w-16">
                                    <img
                                            class="w-12 h-12 rounded-full shadow-md object-cover cursor-pointer transition duration-200 transform hover:scale-105 hover:opacity-90"
                                            [src]="user.photoURL && loadedImages[user.uid] ? user.photoURL : 'assets/images/image-placeholder.png'"
                                            (load)="loadedImages[user.uid] = true"
                                            (click)="goToProfile(user.uid)"
                                            alt="{{ user.displayName }}"
                                    />
                                    <span class="mt-2 text-sm text-gray-800 dark:text-white text-center truncate w-full">
            {{ user.displayName || 'NÃ©vtelen' }}
          </span>
                                </li>
                            </ng-container>

                            <ng-container *ngFor="let i of [].constructor(5 - randomUsersNotFriends.length)">
                                <li class="flex flex-col items-center w-16">
                                    <div class="w-12 h-12 rounded-full bg-gray-300 dark:bg-gray-700 skeleton-shimmer"></div>
                                    <div class="mt-2 h-3 w-10 rounded-full bg-gray-300 dark:bg-gray-700 skeleton-shimmer"></div>
                                </li>
                            </ng-container>
                        </ng-container>

                        <ng-template #skeletonLoading>
                            <li *ngFor="let i of [1, 2, 3, 4, 5]" class="flex flex-col items-center w-16">
                                <div class="w-12 h-12 rounded-full bg-gray-300 dark:bg-gray-700 skeleton-shimmer"></div>
                                <div class="mt-2 h-3 w-10 rounded-full bg-gray-300 dark:bg-gray-700 skeleton-shimmer"></div>
                            </li>
                        </ng-template>
                    </ul>
                </div>
            </div>


        </div>

        <div class="block xl:hidden">
            <button
                    [ngClass]="{  'animate-floatX': !menuOpen}"
                    class="fixed top-24 -left-10 z-50 bg-indigo-600 dark:bg-gray-800 text-white px-2 pl-12 py-3 rounded-r-md shadow-md block md:block xl:hidden transition-transform duration-300"
                    (click)="toggleSideMenu()"
            >
  <span class="material-icons-outlined text-xl">
    {{ menuOpen ? 'chevron_left' : 'chevron_right' }}
  </span>
            </button>


            <div
                    class="fixed inset-0 z-30 bg-black bg-opacity-40 transition-opacity md:block xl:hidden"
                    *ngIf="menuOpen"
                    (click)="toggleSideMenu()">
            </div>

            <div
                    class="fixed inset-y-0 left-0 z-40 w-64 bg-white dark:bg-gray-900 shadow-lg transform transition-transform duration-300 ease-in-out
               xl:static xl:translate-x-0 xl:w-60 md:shadow-none"
                    [ngClass]="{ '-translate-x-full': !menuOpen, 'translate-x-0': menuOpen }">


                <div class="flex flex-col gap-4 h-full justify-between p-2 pt-24">
                    <div class="flex flex-col gap-4 bg-white dark:bg-gray-900 rounded-md shadow-md p-4 transition-all duration-300 hover:-translate-y-1 hover:shadow-xl">
                        <a routerLink="/game" [queryParams]="{ openModal: 'createRoom' }"
                           class="flex items-center text-gray-600 dark:text-gray-300 hover:text-indigo-800 dark:hover:text-indigo-400 py-2 transition-all duration-300 hover:translate-x-1 pl-6">
                            <span class="material-icons-outlined mr-2">dashboard</span>
                            {{ 'home.menu.game' | translate }}
                            <span class="material-icons-outlined ml-auto">keyboard_arrow_right</span>
                        </a>
                        <a (click)="openRoomModal()"
                           class="flex items-center text-gray-600 dark:text-gray-300 hover:text-indigo-800 dark:hover:text-indigo-400 py-4 transition-all duration-300 hover:translate-x-1 cursor-pointer">
                            <span class="material-icons-outlined mr-2">meeting_room</span>
                            {{ 'home.menu.rooms' | translate }}
                            <span class="material-icons-outlined ml-auto">keyboard_arrow_right</span>
                        </a>
                        <a (click)="openInviteModal()"
                           class="flex items-center text-gray-600 dark:text-gray-300 hover:text-indigo-800 dark:hover:text-indigo-400 py-4 transition-all duration-300 hover:translate-x-1 cursor-pointer">
                            <span class="material-icons-outlined mr-2">mail</span>
                            {{ 'home.menu.invitations' | translate }}
                            <span class="material-icons-outlined ml-auto">keyboard_arrow_right</span>
                        </a>
                        <!--                        <a href="#"-->
                        <!--                           class="flex items-center text-gray-600 dark:text-gray-300 hover:text-indigo-800 dark:hover:text-indigo-400 py-2 transition-all duration-300 hover:translate-x-1">-->
                        <!--                            <span class="material-icons-outlined mr-2">tune</span>-->
                        <!--                            {{ 'home.menu.stats' | translate }}-->
                        <!--                            <span class="material-icons-outlined ml-auto">keyboard_arrow_right</span>-->
                        <!--                        </a>-->
                    </div>

                    <div class="flex flex-col gap-4 bg-white dark:bg-gray-900 rounded-md shadow-md p-4 transition-all duration-300 hover:-translate-y-1 hover:shadow-xl">
                        <a routerLink="/profile"
                           class="flex items-center text-gray-600 dark:text-gray-300 hover:text-indigo-800 dark:hover:text-indigo-400 py-2 transition-all duration-300 hover:translate-x-1">
                            <span class="material-icons-outlined mr-2">face</span>
                            {{ 'home.menu.profile' | translate }}
                            <span class="material-icons-outlined ml-auto">keyboard_arrow_right</span>
                        </a>
                        <a (click)="logout()"
                           class="flex items-center text-gray-600 dark:text-gray-300 hover:text-indigo-800 dark:hover:text-indigo-400 py-2 transition-all duration-300 hover:translate-x-1 cursor-pointer">
                            <span class="material-icons-outlined mr-2">power_settings_new</span>
                            {{ 'home.menu.logout' | translate }}
                            <span class="material-icons-outlined ml-auto">keyboard_arrow_right</span>
                        </a>

                        <div class="border-t border-gray-200 dark:border-gray-700 pt-4">
                            <div class="flex items-center justify-between gap-4">
                                <button (click)="toggleTheme()"
                                        class="text-gray-600 dark:text-gray-300 hover:text-indigo-800 dark:hover:text-indigo-400 transition-transform hover:scale-110">
    <span class="material-icons-outlined text-[24px]">
      {{ themeService.isDark() ? 'light_mode' : 'dark_mode' }}
    </span>
                                </button>

                                <div class="relative">
                                    <select
                                            class="appearance-none bg-white dark:bg-gray-800 text-sm rounded-lg px-3 py-2 border border-gray-300 dark:border-gray-600 focus:outline-none transition w-32 pl-10 pr-6 text-center cursor-pointer"
                                            [value]="translate.currentLang"
                                            (change)="changeLanguage($event)">
                                        <option value="hu">ðŸ‡­ðŸ‡º {{ 'language.hu' | translate }}</option>
                                        <option value="en">ðŸ‡¬ðŸ‡§ {{ 'language.en' | translate }}</option>
                                    </select>
                                    <span class="absolute left-2 top-2.5 text-gray-500 dark:text-gray-400 pointer-events-none material-icons-outlined text-sm">
      language
    </span>
                                    <span class="absolute right-2 top-2.5 text-gray-500 dark:text-gray-400 pointer-events-none material-icons-outlined text-sm">
      expand_more
    </span>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4">
            <ng-container *ngIf="!isStatsLoading && lastRoomCharts.length > 0; else loadingStats">
                <div *ngFor="let chart of lastRoomCharts"
                     (click)="navigateToRoomByCode(chart.code)"
                     class="cursor-pointer bg-white dark:bg-gray-800 rounded-xl shadow-lg p-4 transition-all duration-300 hover:-translate-y-1 hover:shadow-xl animate-slide-up h-[350px] flex items-center justify-center">

                    <apx-chart
                            [series]="chart.options.series"
                            [chart]="chart.options.chart"
                            [labels]="chart.options.labels"
                            [responsive]="chart.options.responsive"
                            [title]="chart.options.title"
                            class="w-fit sm:w-full h-full "
                    ></apx-chart>
                </div>

            </ng-container>

            <ng-template #loadingStats>
                <ng-container *ngFor="let i of [1,2,3]">
                    <div class="bg-white dark:bg-gray-800 rounded-xl shadow-lg p-4 h-[420px] flex items-center justify-center animate-slide-up">
                        <div class="relative w-12 h-12">
                            <div class="absolute inset-0 rounded-full border-4 border-indigo-500 border-t-transparent animate-spin"></div>
                            <span class="sr-only">Loading chart...</span>
                        </div>
                    </div>
                </ng-container>
            </ng-template>
        </div>
        <div class="mt-6 flex justify-center">
            <button
                    (click)="openRoomModal()"
                    class="inline-flex items-center gap-2 bg-indigo-600 hover:bg-indigo-700 text-white px-5 py-2 rounded-md shadow transition-all duration-300">
                <span class="material-icons-outlined">bar_chart</span>
                {{ 'room.moreStats' | translate }}
            </button>
        </div>
    </div>
</div>

<!-- ROOM LIST MODAL -->
<div *ngIf="showRoomModal"
     class="fixed inset-0 z-50 flex items-center justify-center bg-black bg-opacity-50 backdrop-blur-sm"
     (click)="closeRoomModal()">

    <div class="relative w-[80%] lg:max-w-md max-h-[80vh] overflow-y-auto rounded-lg shadow-2xl bg-white dark:bg-gray-800 p-4 animate-slide-in-up mt-16"
         (click)="$event.stopPropagation()">

        <button (click)="closeRoomModal()"
                class="sticky top-0 right-0 float-right z-10 text-gray-500 dark:text-gray-300
               hover:text-indigo-800 dark:hover:text-indigo-600
               text-2xl leading-none transition-colors duration-200 ease-in-out">
            &times;
        </button>

        <div class=" mb-4 mt-2">
            <h2 class="text-2xl font-bold text-indigo-600 dark:text-indigo-300 text-start">
                {{ 'room.yourRooms' | translate }}
            </h2>
        </div>

        <ng-container *ngIf="isRoomLoading; else loadedRooms">
            <div class="text-center py-6">
    <span class="material-icons-outlined animate-spin text-indigo-500 text-4xl">
      autorenew
    </span>
                <p class="mt-2 text-gray-500 dark:text-gray-400">{{ 'room.loading' | translate }}</p>
            </div>
        </ng-container>

        <ng-template #loadedRooms>
            <ng-container *ngIf="userRooms.length > 0; else noRooms">
                <ul class="list-none text-start space-y-2">
                    <li *ngFor="let room of userRooms.slice()">
                        <a (click)="navigateToRoom(room)"
                           class="block w-full text-indigo-600 dark:text-indigo-400 hover:text-indigo-800 dark:hover:text-indigo-300 cursor-pointer underline px-2 py-1 break-words">
                            {{ room.roomName }} ({{ 'room.code' | translate }}: {{ room.roomId }})
                            <span *ngIf="room.creator?.uid === currentUserUid"
                                  class="ml-2 text-sm text-yellow-600 dark:text-yellow-400 font-semibold">
                ðŸ‘‘
            </span>
                        </a>
                        <div *ngIf="room.createdAt" class="text-sm text-gray-500 dark:text-gray-400 px-2">
                            {{ 'room.createdAt' | translate }}: {{ room.createdAt | date: 'yyyy.MM.dd - HH:mm' }}
                        </div>

                    </li>
                </ul>


            </ng-container>
        </ng-template>


        <ng-template #noRooms>
            <p class="text-gray-500 dark:text-gray-400 text-center mt-4">
                {{ 'room.noRooms' | translate }}
            </p>
        </ng-template>
    </div>
</div>

<div *ngIf="showRoomInviteModal"
     class="fixed inset-0 z-50 flex items-center justify-center bg-black bg-opacity-50 backdrop-blur-sm"
     (click)="closeInviteModal()">
    <div class="relative w-[90%] lg:max-w-lg max-h-[80vh] overflow-y-auto rounded-lg shadow-2xl bg-white dark:bg-gray-800 p-6 animate-slide-in-up mt-16"
         (click)="$event.stopPropagation()">

        <button (click)="closeInviteModal()"
                class="absolute top-4 right-4 text-gray-600 dark:text-gray-300 hover:text-red-500 text-xl">
            &times;
        </button>

        <h2 class="text-2xl font-bold text-indigo-600 dark:text-indigo-300 mb-4">
            {{ 'room.invites.title' | translate }}
        </h2>

        <ng-container *ngIf="roomInvites.length > 0; else noInvites">
            <div *ngFor="let invite of roomInvites" class="mb-4 border-b pb-4">
                <p class="text-lg font-semibold text-indigo-700 dark:text-indigo-300">
                    {{ invite.inviterName }} {{ 'room.invites.invitedYou' | translate }}:
                </p>
                <p class="text-gray-700 dark:text-gray-200 mb-2">
                    "{{ invite.roomName }}"
                </p>
                <div class="flex gap-2">
                    <button (click)="acceptInvite(invite)"
                            class="bg-indigo-600 hover:bg-indigo-700 text-white px-5 py-2 rounded-lg transition shadow-lg flex items-center gap-2">
                        {{ 'room.invites.accept' | translate }}
                    </button>
                    <button (click)="rejectInvite(invite)"
                            class="bg-pink-600 hover:bg-pink-700 text-white px-5 py-2 rounded-lg  transition shadow-lg flex items-center gap-2">
                        {{ 'room.invites.reject' | translate }}
                    </button>
                </div>
            </div>
        </ng-container>

        <ng-template #noInvites>
            <p class="text-center text-gray-500 dark:text-gray-400">
                {{ 'room.invites.none' | translate }}
            </p>
        </ng-template>
    </div>
</div>



